var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var FacebookChat=require('./FacebookChat');var lastMessages='';module.exports=require("server/types/pluginFunctions.cjs").addPlugin({facebook:{login:{type:'string'},password:{type:'string'},automatic:{checkNewMessage:{type:'boolean',value:false}}}},{os:{linux:true,darwin:true,win32:true,android:true,ios:true},pluginFormatVersion:1},{scriptInitializer:function(){var _scriptInitializer=(0,_asyncToGenerator2.default)(function*(ctx){return new FacebookChat(Object.assign({},ctx,{browserTab:yield ctx.browserPluginStart('https://facebook.com/messages/t')}));});function scriptInitializer(_x){return _scriptInitializer.apply(this,arguments);}return scriptInitializer;}()},{scriptDestructor:function(){var _scriptDestructor=(0,_asyncToGenerator2.default)(function*(ctx){yield ctx.methodsForAI.logout();ctx.methodsForAI.options.browserTab.destructor();});function scriptDestructor(_x2){return _scriptDestructor.apply(this,arguments);}return scriptDestructor;}(),scriptPerInterval:function(){var _scriptPerInterval=(0,_asyncToGenerator2.default)(function*(ctx){if(!ctx.config.facebook.automatic.checkNewMessage.value)return;var result='';try{yield ctx.methodsForAI.options.browserTab.pause.start();yield ctx.methodsForAI.login();var newMessages=yield ctx.methodsForAI.getMessages({makrAsReaded:false},true);var friends=Object.keys(newMessages);var newMessagesString=JSON.stringify(newMessages);if(friends&&friends.length&&lastMessages!==newMessagesString){lastMessages=newMessagesString;if(friends.length>1)result='Prišli nové správy od priateľov '+friends.join(', ').replace(/, ([^,]+)$/,' a $1');if(friends.length===1)result='Prišli novú správu od priateľa '+friends[0];}}catch(err){throw err;}finally{ctx.methodsForAI.options.browserTab.pause.stop();}return result;});function scriptPerInterval(_x3){return _scriptPerInterval.apply(this,arguments);}return scriptPerInterval;}()});