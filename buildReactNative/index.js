var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var FacebookApi=require('./facebook.api');var options={};var api=new FacebookApi(options);var lastMessages='';module.exports=require("server/types/pluginFunctions.cjs").addPlugin({"facebook":{"login":{"type":"string"},"password":{"type":"string"},"automatic":{"checkNewMessage":{"type":"boolean","value":false}}}},{"os":{"linux":true,"darwin":true,"win32":true,"android":true,"ios":true},"pluginFormatVersion":1},{"scriptStart":function(){var _scriptStart=(0,_asyncToGenerator2.default)(function*(ctx){options.tab=yield ctx.browserPluginStart('https://facebook.com/messages/t');});function scriptStart(_x){return _scriptStart.apply(this,arguments);}return scriptStart;}(),"scriptDestructor":function(){var _scriptDestructor=(0,_asyncToGenerator2.default)(function*(ctx){yield api.logout();options.tab.destructor();});function scriptDestructor(_x2){return _scriptDestructor.apply(this,arguments);}return scriptDestructor;}(),"scriptPerInterval":function(){var _scriptPerInterval=(0,_asyncToGenerator2.default)(function*(ctx){if(!ctx.config.facebook.automatic.checkNewMessage.value)return;var result='';try{yield options.tab.pause.start();yield api.login(ctx.config);var newMessages=yield api.getMessages(false,true);var friends=Object.keys(newMessages);var newMessagesString=JSON.stringify(newMessages);if(lastMessages!==newMessagesString){lastMessages=newMessagesString;if(friends.length>1)result='Máš nové správy od priateľov '+friends.join(', ').replace(/, ([^,]+)$/,' a $1');if(friends.length===1)result='Máš novú správu od priateľa '+friends[0];}}catch(err){throw err;}finally{options.tab.pause.stop();}return result;});function scriptPerInterval(_x3){return _scriptPerInterval.apply(this,arguments);}return scriptPerInterval;}()},{"sentenceMemberRequirements":{"_or":[{"example":"Písal mi niekto?","type":"question","predicates":{"multiple":[{"verbs":[{"baseWord":/(na|od)písať/}]}]},"subjects":{"multiple":[{"origWord":/niekto/}]}},{"example":"Mám nejaké nové správy?","type":"question","predicates":{"multiple":[{"verbs":[{"baseWord":/mať|prísť/}]}]},"objects":[{"multiple":[{"baseWord":/správa/}]}]}]}},function(){var _ref=(0,_asyncToGenerator2.default)(function*(ctx){var result='';try{yield ctx.speech('Pozriem Facebook...');yield options.tab.pause.start();yield options.tab.viewTab();yield api.login(ctx.config);var friends=Object.keys(yield api.getMessages(false));if(friends.length>1)result='Máš nové správy od priateľov '+friends.join(', ').replace(/, ([^,]+)$/,' a $1');if(friends.length===1)result='Máš novú správu od priateľa '+friends[0];if(friends.length===0)result='Nemáš žiadne nové správy';}catch(err){throw err;}finally{options.tab.pause.stop();}return result;});return function(_x4){return _ref.apply(this,arguments);};}(),{"sentenceMemberRequirements":{"_or":[{"example":"Prečítaj mi nové správy!","type":"command","predicates":{"multiple":[{"verbs":[{"baseWord":/prečítať/}]}]},"objects":[{"multiple":[{"origWord":/správy|ich/}]}]}]}},function(){var _ref2=(0,_asyncToGenerator2.default)(function*(ctx){var result='';try{yield ctx.speech('Pozriem Facebook...');yield options.tab.pause.start();yield options.tab.viewTab();yield api.login(ctx.config);var messages=yield api.getMessages(true);if(Object.keys(messages).length===0)result='Nemáš žiadne nové správy';else result=Object.keys(messages).map(function(name){return`${name} píše, ${messages[name].join(', ')},`;}).join(', ');}catch(err){throw err;}finally{options.tab.pause.stop();}return result;});return function(_x5){return _ref2.apply(this,arguments);};}(),{"sentenceMemberRequirements":{"example":"Čo mi píše <subject>?","type":"question","predicates":{"multiple":[{"verbs":[{"baseWord":[/(na|od)písať/]}]}]},"subjects":{"multiple":[{"propName":{"friend":"required"}}]},"objects":[{"multiple":[{"origWord":/čo/}]}]}},function(){var _ref3=(0,_asyncToGenerator2.default)(function*(ctx){var result='';try{yield ctx.speech('Pozriem Facebook...');yield options.tab.pause.start();yield options.tab.viewTab();yield api.login(ctx.config);var name=ctx.propName.friend.baseWord;var messages=yield api.getMessages(name);if(!Object.keys(messages).length)result=`${name} ti nenapísal žiadnu novú správu.`;else result=Object.keys(messages).map(function(name){return`${name} píše, ${messages[name].join(', ')},`;}).join(', ');}catch(err){throw err;}finally{options.tab.pause.stop();}return result;});return function(_x6){return _ref3.apply(this,arguments);};}(),{"sentenceMemberRequirements":{"example":"Napíš správu pre <object> citujem ... koniec citácie!","type":"command","predicates":{"multiple":[{"verbs":[{"baseWord":[/(na|od)písať/,/(od|p)oslať/]}]}]},"objects":[{"multiple":[{"origWord":"správu"}]},{"multiple":[{"_or":[{"case":{"key":"3"}},{"preposition":{"origWord":"pre"}}]}],"propName":{"friend":"required"}}]}},function(){var _ref4=(0,_asyncToGenerator2.default)(function*(ctx){var result='';try{yield options.tab.pause.start();yield ctx.speech('Pripravujem Facebook správu ...');yield options.tab.viewTab();yield api.login(ctx.config);var friends=ctx.propName.friend.multiple.map(function(f){return f.baseWord;});var realNames=yield api.sendMessage(friends,'');var unfindedNames=friends.filter(function(n){return!realNames[n];});if(unfindedNames.length){return(unfindedNames.length>1?'Mená':'Meno')+unfindedNames.join(' a ')+' som v blízkych kontaktoch nenašiel.';}else{if(!ctx.propName.citation){var _yield$ctx$speech=yield ctx.speech('Môžeš diktovať Facebook správu',true),text=_yield$ctx$speech.text;ctx.propName.citation=text;}var citation=ctx.propName.citation.replace(/ __? /g,' ');if(yield ctx.getSummaryAccept('FacebookChat plugin: Poslať správu '+(Object.values(realNames).length===1?'priateľovi: ':'priateľom: ')+Object.values(realNames).join(', ')+' s textom: '+citation)){yield api.sendMessage(friends,citation);result='Odoslané...';}}}catch(err){throw err;}finally{options.tab.pause.stop();}return result;});return function(_x7){return _ref4.apply(this,arguments);};}());